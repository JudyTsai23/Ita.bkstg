{"version":3,"sources":["webpack:///./src/views/Management/Meal/Meal.vue?4ddc","webpack:///./src/components/ProcessButtons.vue?bac4","webpack:///src/components/ProcessButtons.vue","webpack:///./src/components/ProcessButtons.vue?727d","webpack:///./src/components/ProcessButtons.vue","webpack:///./src/views/Management/Meal/Meal.vue?df1c","webpack:///./src/views/Management/Meal/Meal.js","webpack:///./src/views/Management/Meal/Meal.js?001a","webpack:///./src/views/Management/Meal/Meal.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","attrs","staticClass","on","$event","edit","_v","del","staticRenderFns","name","props","isChange","type","default","itemId","required","itemGroup","editUrl","delUrl","delMsg","data","methods","checkChanged","AjaxService","url_base","console","computed","delAlertStr","component","_l","cate","key","id","currCateId","class","active","preventDefault","currCateChanged","_s","name_zh","editCate","directives","rawName","value","mealList","length","expression","subCate","subCateName","meals","changed","meal","public","_e","limitDateFormat","limitDate","price","init","addMeal","saveSort","components","draggable","ProcessButtons","$route","query","mealCateList","mounted","getMealCateList","$store","commit","url","ApiUrl","getUrl","get","successResp","restData","resultList","map","item","zhName","log","getMealList","errorResp","date","limit_date","toString","Y","substr","M","D","$router","replace","confirm","push","sortData","forEach","subCute","idx","sort","put"],"mappings":"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","file":"js/chunk-6f439858.b4675851.js","sourcesContent":["export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--9-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--9-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--9-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--9-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Meal.vue?vue&type=style&index=0&id=3b5a4163&lang=scss&scoped=true&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('CButtonToolbar',{attrs:{\"justify\":\"\"}},[_c('IconButton',{staticClass:\"text-white my-1 mr-2\",attrs:{\"color\":\"warning\",\"size\":\"sm\",\"icon\":\"cil-pencil\"},on:{\"clickFn\":function($event){return _vm.edit()}}},[_vm._v(\"編輯\")]),_c('IconButton',{staticClass:\"text-white my-1 mr-2\",attrs:{\"color\":\"danger\",\"size\":\"sm\",\"icon\":\"cil-trash\"},on:{\"clickFn\":function($event){return _vm.del()}}},[_vm._v(\"刪除\")])],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <CButtonToolbar justify>\r\n    <IconButton color=\"warning\" size=\"sm\" icon=\"cil-pencil\" @clickFn=\"edit()\" class=\"text-white my-1 mr-2\">編輯</IconButton>\r\n    <IconButton color=\"danger\" size=\"sm\" icon=\"cil-trash\" @clickFn=\"del()\" class=\"text-white my-1 mr-2\">刪除</IconButton>\r\n  </CButtonToolbar>\r\n</template>\r\n\r\n<script>\r\nimport ApiUrl from \"@/const/apiUrl.js\";\r\nimport AjaxService from \"@/services/ajaxService.js\";\r\n\r\nexport default {\r\n  name: \"ProcessButtons\",\r\n  props: {\r\n    // 是否曾經改動過\r\n    isChange: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    // 處理中項目的ID\r\n    itemId: {\r\n      required: true,\r\n    },\r\n    // 處理中項目所屬的群組\r\n    itemGroup: {\r\n      type: String,\r\n      required: true,\r\n    },\r\n    // 編輯頁面的url\r\n    editUrl: {\r\n      type: String,\r\n      default: \"\",\r\n    },\r\n    // 刪除的url\r\n    delUrl: {\r\n      type: String,\r\n      default: \"\",\r\n    },\r\n    // 刪除的提醒說明\r\n    delMsg: {\r\n      type: String,\r\n      default: \"\",\r\n    },\r\n  },\r\n  data() {\r\n    return {};\r\n  },\r\n  methods: {\r\n    checkChanged() {\r\n      if (this.isChange) {\r\n        if (confirm(\"頁面內容曾修改過，尚未儲存修改的變更將會捨棄！\\n是否確定要離開此頁面？\")) {\r\n          // 確定離開\r\n          return true;\r\n        }\r\n        return false;\r\n      }\r\n      // 未曾修改=>確定離開\r\n      return true;\r\n    },\r\n    edit() {\r\n      if (this.checkChanged()) {\r\n        let url_base = this.editUrl == \"\" ? ApiUrl.getUrl(this.itemGroup, \"edit\") : this.editUrl;\r\n        this.$router.push(url_base + this.itemId);\r\n      }\r\n    },\r\n    del() {\r\n      if (confirm(this.delAlertStr)) {\r\n        if (this.checkChanged()) {\r\n          this.$store.commit(\"set\", [\"globalLoading\", true]);\r\n          let url_base = this.delUrl == \"\" ? ApiUrl.getUrl(this.itemGroup, \"delete\") : this.delUrl;\r\n          AjaxService.delete(\r\n            url_base + this.itemId,\r\n            (successResp) => {\r\n              this.$store.commit(\"set\", [\"globalLoading\", false]);\r\n              console.log(\"刪除成功!\");\r\n              this.$emit(\"reloadFn\");\r\n            },\r\n            (errorResp) => {\r\n              console.log(\"刪除失敗!\");\r\n              console.log(errorResp);\r\n            }\r\n          );\r\n        }\r\n      }\r\n    },\r\n  },\r\n  computed: {\r\n    delAlertStr() {\r\n      return this.delMsg + \"是否確定要刪除？\\n***** 請注意！刪除後無法復原！*****\";\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\" scoped></style>\r\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ProcessButtons.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ProcessButtons.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./ProcessButtons.vue?vue&type=template&id=9e645470&scoped=true&\"\nimport script from \"./ProcessButtons.vue?vue&type=script&lang=js&\"\nexport * from \"./ProcessButtons.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"9e645470\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('CCard',[_c('CCardHeader',{staticClass:\"h5 font-weight-bold\"},[_c('CIcon',{staticClass:\"mt-0\",attrs:{\"name\":\"cil-restaurant\"}}),_vm._v(\" 餐點管理 \")],1),_c('CCardBody',[_c('ul',{staticClass:\"nav nav-tabs mb-3\"},[_vm._l((_vm.mealCateList),function(cate){return _c('li',{key:cate.id,staticClass:\"nav-item\",attrs:{\"active\":_vm.currCateId == cate.id}},[_c('a',{staticClass:\"nav-link\",class:{ active: _vm.currCateId == cate.id },attrs:{\"href\":\"#\"},on:{\"click\":function($event){$event.preventDefault();return _vm.currCateChanged(cate.id)}}},[_vm._v(_vm._s(cate.name_zh))])])}),_c('IconButton',{staticClass:\"align-self-center ml-3 py-0\",attrs:{\"color\":\"dark\",\"variant\":\"outline\",\"size\":\"sm\",\"icon\":\"cil-pencil\"},on:{\"clickFn\":function($event){return _vm.editCate()}}},[_vm._v(\"修改類別\")])],2),_c('CAlert',{attrs:{\"color\":\"info\",\"closeButton\":\"\"}},[_c('p',[_vm._v(\" 拖曳前方的 \"),_c('span',{staticClass:\"border border-dark px-1\"},[_c('CIcon',{staticClass:\"align-text-bottom\",attrs:{\"name\":\"cil-elevator\"}})],1),_vm._v(\" 來進行排序，修改後請按下方的 \"),_c('span',{staticClass:\"border border-dark rounded px-1\"},[_vm._v(\"儲存排序\")]),_vm._v(\" 。 \")]),_c('p',{staticClass:\"mb-0\"},[_vm._v(\" 如需更換餐點所屬的子類別，請點擊該餐點的 \"),_c('span',{staticClass:\"border border-dark rounded px-1\"},[_vm._v(\"編輯\")]),_vm._v(\" 按鈕前往頁面進行修改。 \")])]),_c('p',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.mealList.length == 0),expression:\"mealList.length == 0\"}],staticClass:\"text-muted text-center my-4\"},[_vm._v(\"此類別中尚無餐點\")]),_vm._l((_vm.mealList),function(subCate){return _c('div',{key:(\"subCate\" + (subCate.subCateId))},[_c('p',{staticClass:\"h4 font-weight-bold mt-4\"},[_vm._v(\" \"+_vm._s(subCate.subCateName)+\" \")]),_c('draggable',{staticClass:\"list-unstyled px-4\",attrs:{\"tag\":\"ul\",\"list\":subCate.meals,\"handle\":\".move-icon\",\"animation\":200},on:{\"change\":function($event){_vm.changed = true}}},[_c('transition-group',{attrs:{\"name\":\"flip-list\"}},_vm._l((subCate.meals),function(meal){return _c('li',{key:meal.id,staticClass:\"row align-items-center border mb-3\"},[_c('CIcon',{attrs:{\"name\":\"cil-elevator\",\"customClasses\":\"move-icon border-right\"}}),_c('div',{staticClass:\"col text-left\"},[_vm._v(_vm._s(meal.name))]),_c('div',{staticClass:\"col-auto d-flex align-items-center\"},[(!meal.public)?_c('CBadge',{staticClass:\"label-badge ml-3\",attrs:{\"color\":\"light\"}},[_vm._v(\"隱藏\")]):_vm._e(),(meal.limitDate)?_c('CBadge',{staticClass:\"small ml-3\",attrs:{\"color\":\"warning-light\"}},[_vm._v(\" 期間限定 \"),_c('br'),_vm._v(\" \"+_vm._s(_vm.limitDateFormat(meal.limitDate))+\" \")]):_vm._e(),_c('span',{staticClass:\"ml-3\"},[_vm._v(\"$ \"+_vm._s(meal.price))])],1),_c('ProcessButtons',{staticClass:\"border-left pl-3\",attrs:{\"is-change\":_vm.changed,\"item-id\":meal.id,\"item-group\":\"meal\",\"edit-url\":\"/mngt/meal/edit/\"},on:{\"reloadFn\":_vm.init}})],1)}),0)],1)],1)})],2),_c('CCardFooter',{attrs:{\"align\":\"right\"}},[_c('CButton',{staticClass:\"mr-2\",attrs:{\"color\":\"info\"},on:{\"click\":function($event){return _vm.addMeal()}}},[_vm._v(\"新增餐點\")]),_c('CButton',{attrs:{\"color\":\"success\"},on:{\"click\":function($event){return _vm.saveSort()}}},[_vm._v(\"儲存排序\")])],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import ApiUrl from \"@/const/apiUrl.js\";\r\nimport AjaxService from \"@/services/ajaxService.js\";\r\nimport draggable from \"vuedraggable\";\r\nimport ProcessButtons from \"@/components/ProcessButtons\";\r\n\r\nexport default {\r\n  name: \"Meal\",\r\n  components: {\r\n    draggable,\r\n    ProcessButtons,\r\n  },\r\n  data() {\r\n    return {\r\n      // 當前餐點類別ID\r\n      currCateId: this.$route.query.cate,\r\n      // 所有餐點類別 (id和中文名稱)\r\n      mealCateList: [],\r\n      // 當前類別的所有餐點\r\n      mealList: [],\r\n      // 是否曾經改動過\r\n      changed: false,\r\n    };\r\n  },\r\n  mounted() {\r\n    this.init();\r\n  },\r\n  methods: {\r\n    init() {\r\n      this.getMealCateList();\r\n    },\r\n    // 取得所有餐點類別，並取得目前類別的所有餐點(執行getMealList)\r\n    getMealCateList() {\r\n      this.$store.commit(\"set\", [\"globalLoading\", true]);\r\n      let url = ApiUrl.getUrl(\"mealCate\", \"getAll\");\r\n      AjaxService.get(\r\n        url,\r\n        (successResp) => {\r\n          if (successResp.restData) {\r\n            let resultList = successResp.restData;\r\n            this.mealCateList = resultList.map((item) => {\r\n              let cate = {\r\n                id: item.id,\r\n                name_zh: item.zhName,\r\n              };\r\n              return cate;\r\n            });\r\n            console.log(\"查詢餐點類別成功!\");\r\n\r\n            // 是否有需要顯示的類別，若無則顯示第一個類別\r\n            if (!this.currCateId) {\r\n              this.currCateId = this.mealCateList[0].id;\r\n            }\r\n            this.getMealList();\r\n            this.$store.commit(\"set\", [\"globalLoading\", false]);\r\n          }\r\n        },\r\n        (errorResp) => {\r\n          console.log(\"查詢餐點類別失敗!\");\r\n          console.log(errorResp);\r\n        }\r\n      );\r\n    },\r\n    // 取得當前類別的所有餐點\r\n    getMealList() {\r\n      this.$store.commit(\"set\", [\"globalLoading\", true]);\r\n      let url = ApiUrl.getUrl(\"meal\", \"getAll\") + this.currCateId;\r\n      AjaxService.get(\r\n        url,\r\n        (successResp) => {\r\n          if (successResp.restData) {\r\n            this.mealList = successResp.restData;\r\n            this.$store.commit(\"set\", [\"globalLoading\", false]);\r\n            console.log(\"查詢餐點成功!\");\r\n          }\r\n        },\r\n        (errorResp) => {\r\n          console.log(\"查詢餐點失敗!\");\r\n          console.log(errorResp);\r\n        }\r\n      );\r\n    },\r\n    // 處理期間限定的日期值\r\n    limitDateFormat(date) {\r\n      let limit_date = date.toString();\r\n      let Y = limit_date.substr(0, 4),\r\n        M = limit_date.substr(4, 2),\r\n        D = limit_date.substr(6, 2);\r\n      return `${Y}.${M}.${D}`;\r\n    },\r\n    // 切換餐點類別\r\n    currCateChanged(id) {\r\n      this.currCateId = id;\r\n      this.getMealList();\r\n      this.$router.replace(\"/mngt/meal?cate=\" + id);\r\n    },\r\n    // 檢查頁面內容是否曾修改過\r\n    checkChanged() {\r\n      if (this.changed) {\r\n        if (confirm(\"頁面內容曾修改過，尚未儲存修改的變更將會捨棄！\\n是否確定要離開此頁面？\")) {\r\n          // 確定離開\r\n          return true;\r\n        }\r\n        return false;\r\n      }\r\n      // 未曾修改=>確定離開\r\n      return true;\r\n    },\r\n    // 前往修改餐點類別\r\n    editCate() {\r\n      if (this.checkChanged()) {\r\n        this.$router.push(\"/mngt/meal/cate\");\r\n      }\r\n    },\r\n    // 前往新增餐點\r\n    addMeal() {\r\n      if (this.checkChanged()) {\r\n        this.$router.push(\"/mngt/meal/create?cate=\" + this.currCateId);\r\n      }\r\n    },\r\n    // 送出排序資料儲存\r\n    saveSort() {\r\n      this.$store.commit(\"set\", [\"globalLoading\", true]);\r\n      let sortData = [];\r\n      this.mealList.forEach((subCute) => {\r\n        subCute.meals.forEach((item, idx) => {\r\n          sortData.push({\r\n            id: item.id,\r\n            sort: idx + 1,\r\n          });\r\n        });\r\n      });\r\n      let url = ApiUrl.getUrl(\"meal\", \"saveSort\");\r\n      AjaxService.put(\r\n        url,\r\n        sortData,\r\n        (successResp) => {\r\n          this.$store.commit(\"set\", [\"globalLoading\", false]);\r\n          console.log(\"修改餐點排序成功!\");\r\n          this.getMealList();\r\n        },\r\n        (errorResp) => {\r\n          console.log(\"修改餐點排序失敗!\");\r\n          console.log(errorResp);\r\n        }\r\n      );\r\n    },\r\n  },\r\n};\r\n","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!./Meal.js?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!./Meal.js?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Meal.vue?vue&type=template&id=3b5a4163&scoped=true&\"\nimport script from \"./Meal.js?vue&type=script&lang=js&\"\nexport * from \"./Meal.js?vue&type=script&lang=js&\"\nimport style0 from \"./Meal.vue?vue&type=style&index=0&id=3b5a4163&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"3b5a4163\",\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}