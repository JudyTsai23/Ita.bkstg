(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-f6a6d0c4"],{"0813":function(t,e,a){"use strict";a("2e28")},"2e28":function(t,e,a){},"5c1d":function(t,e,a){},"7aaf":function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("CInputFile",{staticClass:"form-group",attrs:{placeholder:t.UploadImageSelectedStr,custom:"",horizontal:t.horizontal,required:t.isRequired,accept:"image/*",id:t.safeId},on:{change:t.GetUploadImage},scopedSlots:t._u([t.horizontal?{key:"label",fn:function(){return[a("span",{class:t.LabelGridClass},[t._v(" "+t._s(t.label)+" "),t.isRequired?a("span",{staticClass:"text-danger"},[t._v("*")]):t._e()])]},proxy:!0}:null,{key:"description",fn:function(){return[a("div",{directives:[{name:"show",rawName:"v-show",value:t.ImagePreviewSrc,expression:"ImagePreviewSrc"}],staticClass:"mt-2"},[a("small",{staticClass:"d-block"},[t._v(t._s(t.ImagePreviewTitle))]),a("label",{staticClass:"position-relative img-thumbnail bg-white",attrs:{for:t.safeId}},[a("img",{style:"max-width:"+t.maxPreview,attrs:{src:t.ImagePreviewSrc,alt:""}}),a("CButton",{directives:[{name:"show",rawName:"v-show",value:t.UploadImage,expression:"UploadImage"}],staticClass:"align-top p-1",attrs:{color:"danger",shape:"pill"},on:{click:t.removeUploadImage}},[a("CIcon",{staticClass:"m-0",attrs:{name:"cil-x",size:"sm"}})],1)],1)])]},proxy:!0}],null,!0)})},s=[],n=function(){var t=Math.random().toString(36).substr(2);return"uid-"+t},o=n,l={name:"ImageInput",props:{value:{type:String},label:{type:String,default:""},wasValidated:Boolean,horizontal:{type:[Boolean,Object],default:!1},oldImage:{type:String,default:""},limitSize:{type:Number},limitUnit:{type:String,default:"KB"},maxPreview:{type:String,default:"100%"}},watch:{value:function(t){this.UploadImage=t},UploadImage:function(t){this.$emit("update:value",t)}},data:function(){return{UploadImage:"",UploadImageName:""}},computed:{safeId:function(){return this.id||this.$attrs.id?this.id||this.$attrs.id:o()},isRequired:function(){return""==this.oldImage},LabelGridClass:function(){return!0===this.horizontal?"col-sm-3 col-form-label":this.horizontal instanceof Object?this.horizontal.label+" col-form-label":void 0},UploadImageSelectedStr:function(){return""==this.UploadImageName?"尚未選擇檔案":this.UploadImageName},ImagePreviewTitle:function(){return this.oldImage&&!this.UploadImage?"現有影像":this.UploadImage?"上傳預覽":void 0},ImagePreviewSrc:function(){return this.oldImage&&!this.UploadImage?this.oldImage:this.UploadImage?this.UploadImage:""}},methods:{GetUploadImage:function(t,e){var a=this,i=t.item(0);if(i){var s=!this.limitSize||this.Validfile(i,"image",this.limitSize,this.limitUnit);if(s){this.UploadImageName=i.name;var n=new FileReader;n.addEventListener("load",(function(t){a.UploadImage=t.target.result})),n.readAsDataURL(i)}else this.removeUploadImage()}},Validfile:function(t,e,a,i){switch(i){case"Byte":var s=1;break;case"KB":s=1024;break;case"MB":s=1048576;break;case"GB":s=1073741824;break;default:break}var n=(t.size/s).toFixed(0),o=t.name.substring(t.name.lastIndexOf("."));switch(e){case"image":if(!o.match(/.jpg|.jpeg|.png|.svg/i))return alert("請上傳圖片檔案(.jpg|.jpeg|.png|.svg)"),!1;break;default:return console.error("type_參數設置錯誤！"),!1}return!(n>a)||(alert("檔案不能超過"+a+i),!1)},removeUploadImage:function(){this.UploadImage="",this.UploadImageName="",document.getElementById(this.safeId).value=null}}},r=l,c=(a("9a6f"),a("2877")),u=Object(c["a"])(r,i,s,!1,null,"37f136e6",null);e["a"]=u.exports},"7f6a":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("CCard",[a("CCardHeader",{staticClass:"h5 font-weight-bold"},[a("CIcon",{staticClass:"mt-0",attrs:{name:"cil-list-numbered"}}),t._v(" "+t._s(this.$route.name)+" ")],1),a("CCardBody",[a("CRow",{staticClass:"needs-validation",attrs:{tag:"form",id:"updateForm"}},[a("CCol",{attrs:{sm:"6",md:"5"}},[a("div",{staticClass:"cate-info rounded p-3 mb-5 mb-sm-0"},[a("CInput",{ref:"inputName",attrs:{label:"名稱",placeholder:"請填寫類別名稱",invalidFeedback:"必填",horizontal:"",required:"",maxlength:"10",id:"inputName"},scopedSlots:t._u([{key:"label",fn:function(){return[a("label",{staticClass:"col-sm-3 col-form-label",attrs:{for:"inputName"}},[t._v(" 名稱 "),a("span",{staticClass:"text-danger"},[t._v("*")])])]},proxy:!0}]),model:{value:t.mealCateData.name_zh,callback:function(e){t.$set(t.mealCateData,"name_zh",e)},expression:"mealCateData.name_zh"}}),a("CInput",{ref:"inputSlug",attrs:{placeholder:"請填寫Slug",invalidFeedback:"必填",horizontal:"",required:"",maxlength:"10",id:"inputSlug"},scopedSlots:t._u([{key:"label",fn:function(){return[a("label",{staticClass:"col-sm-3 col-form-label",attrs:{for:"inputSlug"}},[t._v(" Slug "),a("span",{staticClass:"text-danger"},[t._v("*")]),a("CIcon",{directives:[{name:"c-tooltip",rawName:"v-c-tooltip",value:"網址使用的別名",expression:"'網址使用的別名'"}],staticClass:"icon-circle bg-warning text-white ml-2",attrs:{name:"cil-lightbulb"}})],1)]},proxy:!0}]),model:{value:t.mealCateData.name,callback:function(e){t.$set(t.mealCateData,"name",e)},expression:"mealCateData.name"}}),a("ImageInput",{attrs:{label:"圖示",horizontal:"",limitSize:300,limitUnit:"KB",maxPreview:"120px",oldImage:t.mealCateData.icon,value:t.UploadImage},on:{"update:value":function(e){t.UploadImage=e}}})],1)]),a("CCol",{attrs:{sm:"6",md:"7"}},[a("p",{staticClass:"d-flex justify-content-between align-items-center h5 font-weight-bold"},[t._v(" 子類別 "),a("IconButton",{staticClass:"text-white mr-2",attrs:{size:"sm",color:"info",icon:"cil-playlist-add"},on:{clickFn:function(e){return t.addSubCate()}}},[t._v("新增子類別")])],1),a("p",{directives:[{name:"show",rawName:"v-show",value:0==t.subCateList.length,expression:"subCateList.length == 0"}],staticClass:"text-muted text-center my-4"},[t._v("尚無子類別")]),a("draggable",{staticClass:"list-unstyled px-4",attrs:{tag:"ul",list:t.subCateList,handle:".move-icon",animation:200},on:{change:function(e){t.changed=!0}}},[a("transition-group",{attrs:{name:"flip-list"}},t._l(t.subCateList,(function(e,i){return a("li",{key:"subCate"+i,staticClass:"row align-items-center border list-group-item-info mb-3"},[a("CIcon",{attrs:{name:"cil-elevator",customClasses:"move-icon"}}),a("CInput",{staticClass:"col p-0 mb-0",attrs:{placeholder:"請填寫子類別名稱",addInputClasses:"input-subCate",required:"",maxlength:"10"},model:{value:e.name,callback:function(a){t.$set(e,"name",a)},expression:"subCate.name"}}),a("CButton",{staticClass:"del-btn",on:{click:function(e){return t.delSubCate(i)}}},[a("CIcon",{attrs:{name:"cil-trash"}})],1)],1)})),0)],1)],1)],1)],1),a("CCardFooter",{attrs:{align:"right"}},[t.currId?a("IconButton",{staticClass:"float-left",attrs:{color:"danger",icon:"cil-trash"},on:{clickFn:function(e){return t.del()}}},[t._v("刪除此類別")]):t._e(),a("CButton",{staticClass:"mr-3",attrs:{color:"secondary",variant:"outline",to:"/mngt/meal/cate/"}},[t._v("取消")]),a("CButton",{attrs:{color:"success"},on:{click:function(e){return t.save()}}},[t._v("儲存設定")])],1)],1)},s=[],n=a("35ab"),o=a("20fc"),l=a("b76a"),r=a.n(l),c=a("7aaf");function u(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,i)}return a}function m(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?u(Object(a),!0).forEach((function(e){d(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):u(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function d(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}var g={name:"MealCateEdit",components:{draggable:r.a,ImageInput:c["a"]},data:function(){return{currId:this.$route.params.id,mealCateData:{id:"",name:"",name_zh:"",icon:"",sort:"",subCateList:Array()},db_mealCateData:{},UploadImage:"",changed:!1}},mounted:function(){this.init()},methods:{init:function(){void 0!==this.currId&&this.getMealCateData()},getMealCateData:function(){var t=this;this.$store.commit("set",["globalLoading",!0]);var e=n["a"].getUrl("mealCate","getOne")+this.currId;o["a"].get(e,(function(e){if(e.restData){var a=e.restData[0];t.mealCateData={id:a.id,name:a.name,name_zh:a.zhName,icon:a.icon,sort:a.sort,subCateList:a.subCateList},t.db_mealCateData=m({},t.mealCateData),t.db_mealCateData.subCateList=a.subCateList.map((function(t){return m({},t)})),t.$store.commit("set",["globalLoading",!1]),console.log("查詢餐點類別成功!")}}),(function(t){console.log("查詢餐點類別失敗!"),console.log(t)}))},checkChanged:function(){var t=JSON.stringify(this.mealCateData)!=JSON.stringify(this.db_mealCateData);return!(this.changed||t||this.UploadImage)||!!confirm("頁面內容曾修改過，尚未儲存修改的變更將會捨棄！\n是否確定要離開此頁面？")},addSubCate:function(){var t=this;this.subCateList.push({id:"",name:"",sort:""}),this.$nextTick((function(){var e=t.subCateList.length-1;document.querySelectorAll(".input-subCate").item(e).focus()}))},delSubCate:function(t){var e=this;if(""!=this.subCateList[t].id){if(confirm("將會連同類別中的餐點一並刪除！是否確定要刪除？\n***** 請注意！刪除後無法復原！*****")&&this.checkChanged()){this.$store.commit("set",["globalLoading",!0]);var a=n["a"].getUrl("mealCate","deleteSub")+this.subCateList[t].id;o["a"].delete(a,(function(t){e.$store.commit("set",["globalLoading",!1]),console.log("刪除餐點子類別成功!"),e.init()}),(function(t){console.log("刪除餐點子類別失敗!"),console.log(t)}))}}else this.subCateList.splice(t,1)},save:function(){var t=this,e=document.querySelector("#updateForm");if(e.classList.add("was-validated"),!0===e.checkValidity()){this.$store.commit("set",["globalLoading",!0]);var a=this.subCateList.map((function(t,e){return t.sort=e+1,t})),i=""!=this.UploadImage?this.UploadImage:this.mealCateData.icon,s={id:this.mealCateData.id,name:this.mealCateData.name,zhName:this.mealCateData.name_zh,icon:i,sort:this.mealCateData.sort,subCateList:a},l=n["a"].getUrl("mealCate","save");o["a"].post(l,s,(function(e){t.$store.commit("set",["globalLoading",!1]),console.log("修改餐點類別成功!"),t.$router.push("/mngt/meal/cate")}),(function(a){if(console.log("修改餐點類別失敗!"),console.log(a),a.appCode="ERROR_002"){t.$store.commit("set",["globalLoading",!1]);var i=a.response.data.appMsg,s="Slug 不得重複"==i?t.$refs.inputSlug:t.$refs.inputName;s.addInputClasses="is-invalid",s.invalidFeedback=i,document.getElementById(s.safeId).focus(),e.classList.remove("was-validated"),alert(i)}}))}else document.querySelector("input:invalid,select:invalid,textarea:invalid").focus()},del:function(){var t=this;if(confirm("將會連同類別中的餐點一並刪除！ 是否確定要刪除？\n***** 請注意！刪除後無法復原！*****")){this.$store.commit("set",["globalLoading",!0]);var e=n["a"].getUrl("mealCate","delete");o["a"].delete(e+this.mealCateData.id,(function(e){t.$store.commit("set",["globalLoading",!1]),console.log("刪除成功!"),t.$router.push("/mngt/meal/cate")}),(function(t){console.log("刪除失敗!"),console.log(t)}))}}},computed:{subCateList:function(){return this.mealCateData.subCateList}}},p=g,f=(a("0813"),a("2877")),h=Object(f["a"])(p,i,s,!1,null,"7a4738e6",null);e["default"]=h.exports},"9a6f":function(t,e,a){"use strict";a("5c1d")}}]);
//# sourceMappingURL=chunk-f6a6d0c4.5590d639.js.map