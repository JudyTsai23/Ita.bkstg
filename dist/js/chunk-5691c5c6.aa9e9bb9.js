(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5691c5c6"],{"35ab":function(e,t,a){"use strict";var n={meal:{getAll:"/server/menu/meals/",getOne:"/server/menu/meal/",save:"/server/menu/save",saveSort:"/server/menu",delete:"/server/menu/"},mealCate:{getAll:"/server/mealCate/cate",getAllSub:"/server/mealCate/sub",getOne:"/server/mealCate/",save:"/server/mealCate/save",saveSort:"/server/mealCate",delete:"/server/mealCate/",deleteSub:"/server/mealCate/sub/"},news:{getAll:"/server/news",getOne:"/server/news/mng/",save:"/server/news/save",delete:"/server/news/"}},s={getUrl:function(e,t){if(e||t){var a=n[e][t];return void 0!==a?a:null}return null}};t["a"]=s},"5c1d":function(e,t,a){},"7aaf":function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("CInputFile",{staticClass:"form-group",attrs:{placeholder:e.UploadImageSelectedStr,custom:"",horizontal:e.horizontal,required:e.isRequired,accept:"image/*",id:e.safeId},on:{change:e.GetUploadImage},scopedSlots:e._u([e.horizontal?{key:"label",fn:function(){return[a("span",{class:e.LabelGridClass},[e._v(" "+e._s(e.label)+" "),e.isRequired?a("span",{staticClass:"text-danger"},[e._v("*")]):e._e()])]},proxy:!0}:null,{key:"description",fn:function(){return[a("div",{directives:[{name:"show",rawName:"v-show",value:e.ImagePreviewSrc,expression:"ImagePreviewSrc"}],staticClass:"mt-2"},[a("small",{staticClass:"d-block"},[e._v(e._s(e.ImagePreviewTitle))]),a("label",{staticClass:"position-relative img-thumbnail bg-white",attrs:{for:e.safeId}},[a("img",{style:"max-width:"+e.maxPreview,attrs:{src:e.ImagePreviewSrc,alt:""}}),a("CButton",{directives:[{name:"show",rawName:"v-show",value:e.UploadImage,expression:"UploadImage"}],staticClass:"align-top p-1",attrs:{color:"danger",shape:"pill"},on:{click:e.removeUploadImage}},[a("CIcon",{staticClass:"m-0",attrs:{name:"cil-x",size:"sm"}})],1)],1)])]},proxy:!0}],null,!0)})},s=[],i=function(){var e=Math.random().toString(36).substr(2);return"uid-"+e},l=i,r={name:"ImageInput",props:{value:{type:String},label:{type:String,default:""},wasValidated:Boolean,horizontal:{type:[Boolean,Object],default:!1},oldImage:{type:String,default:""},limitSize:{type:Number},limitUnit:{type:String,default:"KB"},maxPreview:{type:String,default:"100%"}},watch:{value:function(e){this.UploadImage=e},UploadImage:function(e){this.$emit("update:value",e)}},data:function(){return{UploadImage:"",UploadImageName:""}},computed:{safeId:function(){return this.id||this.$attrs.id?this.id||this.$attrs.id:l()},isRequired:function(){return""==this.oldImage},LabelGridClass:function(){return!0===this.horizontal?"col-sm-3 col-form-label":this.horizontal instanceof Object?this.horizontal.label+" col-form-label":void 0},UploadImageSelectedStr:function(){return""==this.UploadImageName?"尚未選擇檔案":this.UploadImageName},ImagePreviewTitle:function(){return this.oldImage&&!this.UploadImage?"現有影像":this.UploadImage?"上傳預覽":void 0},ImagePreviewSrc:function(){return this.oldImage&&!this.UploadImage?this.oldImage:this.UploadImage?this.UploadImage:""}},methods:{GetUploadImage:function(e,t){var a=this,n=e.item(0);if(n){var s=!this.limitSize||this.Validfile(n,"image",this.limitSize,this.limitUnit);if(s){this.UploadImageName=n.name;var i=new FileReader;i.addEventListener("load",(function(e){a.UploadImage=e.target.result})),i.readAsDataURL(n)}else this.removeUploadImage()}},Validfile:function(e,t,a,n){switch(n){case"Byte":var s=1;break;case"KB":s=1024;break;case"MB":s=1048576;break;case"GB":s=1073741824;break;default:break}var i=(e.size/s).toFixed(0),l=e.name.substring(e.name.lastIndexOf("."));switch(t){case"image":if(!l.match(/.jpg|.jpeg|.png|.svg/i))return alert("請上傳圖片檔案(.jpg|.jpeg|.png|.svg)"),!1;break;default:return console.error("type_參數設置錯誤！"),!1}return!(i>a)||(alert("檔案不能超過"+a+n),!1)},removeUploadImage:function(){this.UploadImage="",this.UploadImageName="",document.getElementById(this.safeId).value=null}}},o=r,c=(a("9a6f"),a("2877")),u=Object(c["a"])(o,n,s,!1,null,"37f136e6",null);t["a"]=u.exports},"9a6f":function(e,t,a){"use strict";a("5c1d")},a706:function(e,t,a){},c944:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("CCard",[a("CCardHeader",{staticClass:"h5 font-weight-bold"},[a("CIcon",{staticClass:"mt-0",attrs:{name:"cil-bullhorn"}}),e._v(" "+e._s(this.$route.name)+" ")],1),a("CCardBody",[a("CForm",{staticClass:"needs-validation",attrs:{id:"updateForm"}},[a("CSelect",{attrs:{label:"訊息類別",placeholder:"請選擇類別",invalidFeedback:"必選",horizontal:"",required:"",options:e.newsTypeList},model:{value:e.newsData.type,callback:function(t){e.$set(e.newsData,"type",t)},expression:"newsData.type"}}),a("CInput",{attrs:{label:"標題",placeholder:"請填寫訊息標題",invalidFeedback:"必填",horizontal:"",required:"",maxlength:"20"},model:{value:e.newsData.title,callback:function(t){e.$set(e.newsData,"title",t)},expression:"newsData.title"}}),a("CTextarea",{attrs:{label:"描述",placeholder:"請簡述訊息內容",invalidFeedback:"必填",horizontal:"",required:"",maxlength:"220",rows:"4",description:(e.newsData.description?e.newsData.description.length:0)+" / 220",addWrapperClasses:"limit-hint"},model:{value:e.newsData.description,callback:function(t){e.$set(e.newsData,"description",t)},expression:"newsData.description"}}),a("CTextarea",{attrs:{label:"內文",placeholder:"請撰寫訊息內容",invalidFeedback:"必填",horizontal:"",required:"",maxlength:"950",rows:"6",description:(e.newsData.content?e.newsData.content.length:0)+" / 950",addWrapperClasses:"limit-hint"},model:{value:e.newsData.content,callback:function(t){e.$set(e.newsData,"content",t)},expression:"newsData.content"}}),a("ImageInput",{attrs:{label:"封面圖片",horizontal:"",limitSize:300,limitUnit:"KB",maxPreview:"300px",oldImage:e.newsData.image,value:e.UploadImage},on:{"update:value":function(t){e.UploadImage=t}}}),a("CInput",{attrs:{type:"date",label:"發布日期",placeholder:"請選擇訊息公開發布的日期",horizontal:"",required:""},model:{value:e.newsData.publish_date,callback:function(t){e.$set(e.newsData,"publish_date",t)},expression:"newsData.publish_date"}}),a("CRow",{staticClass:"form-group",attrs:{form:""}},[a("CCol",{staticClass:"col-form-label",attrs:{sm:"3"}},[e._v(" 是否公開 "),a("span",{staticClass:"text-danger"},[e._v("*")])]),a("CCol",{staticClass:"form-row justify-content-start mx-0",attrs:{sm:"9"}},[a("CInputRadioGroup",{attrs:{custom:"",inline:"",checked:e.newsData.public,options:[{value:!0,label:"公開"},{value:!1,label:"隱藏"}]},on:{"update:checked":function(t){return e.$set(e.newsData,"public",t)}}})],1)],1),a("CRow",{staticClass:"form-group",attrs:{form:""}},[a("CCol",{staticClass:"col-form-label",attrs:{sm:"3"}},[e._v("是否置頂")]),a("CCol",{staticClass:"form-row justify-content-start align-items-center mx-0",attrs:{sm:"9"}},[a("CSwitch",{attrs:{color:"danger",size:"sm",shape:"pill",labelOn:"✓",labelOff:"✕",checked:e.newsData.top},on:{"update:checked":function(t){return e.$set(e.newsData,"top",t)}}})],1)],1)],1)],1),a("CCardFooter",{attrs:{align:"right"}},[e.currId?a("IconButton",{staticClass:"float-left",attrs:{color:"danger",icon:"cil-trash"},on:{clickFn:function(t){return e.del()}}},[e._v("刪除此訊息")]):e._e(),a("CButton",{staticClass:"mr-3",attrs:{color:"secondary",variant:"outline",to:"/mngt/news"}},[e._v("取消")]),a("CButton",{attrs:{color:"success"},on:{click:function(t){return e.save()}}},[e._v("儲存設定")])],1)],1)},s=[],i=a("35ab"),l=a("20fc"),r=[{name:"活動",value:0},{name:"公告",value:1}],o={getOptions:function(){return r.map((function(e){return{label:e.name,value:e.value}}))},getTypeNameByValue:function(e){if(e instanceof Number){var t=t.find((function(t){return t.value===e}));if(t)return t.name}return""},getTypeValueByName:function(e){if(e){var t=t.find((function(t){return t.name===e}));if(t)return t.value}return null}},c=o,u=a("7aaf"),d={name:"NewsEdit",components:{ImageInput:u["a"]},data:function(){return{currId:this.$route.params.id,newsData:{id:"",type:"",title:"",description:"",content:"",image:"",publish_date:"",public:!0,top:!1},newsTypeList:c.getOptions(),UploadImage:""}},mounted:function(){this.init()},methods:{init:function(){void 0!==this.currId&&this.getNewsData(),this.addRequiredMark()},getNewsData:function(){var e=this;this.$store.commit("set",["globalLoading",!0]);var t=i["a"].getUrl("news","getOne")+this.currId;l["a"].get(t,(function(t){if(t.restData){var a=t.restData,n="";if(a.publishDate){n=a.publishDate.toString();var s=n.substr(0,4),i=n.substr(4,2),l=n.substr(6,2);n="".concat(s,"-").concat(i,"-").concat(l)}e.newsData={id:a.id,type:a.type,title:a.title,description:a.description,content:a.content,image:a.image,publish_date:n,public:a.public,top:a.top},e.$store.commit("set",["globalLoading",!1]),console.log("查詢訊息成功!")}}),(function(e){console.log("查詢訊息失敗!"),console.log(e)}))},addRequiredMark:function(){var e=document.querySelectorAll("input[required]:not([type='file']),textarea[required],select[required]");e.forEach((function(e){e.parentElement.previousElementSibling.innerHTML+='<span class="text-danger">*</span>'}))},save:function(){var e=this,t=document.querySelector("#updateForm");if(t.classList.add("was-validated"),!0===t.checkValidity()){this.$store.commit("set",["globalLoading",!0]);var a=""!=this.UploadImage?this.UploadImage:this.newsData.image,n=this.newsData.publish_date.replace(/-/g,""),s={id:this.newsData.id,type:this.newsData.type,title:this.newsData.title,description:this.newsData.description,content:this.newsData.content,image:a,publishDate:n,public:this.newsData.public,top:this.newsData.top},r=i["a"].getUrl("news","save");l["a"].post(r,s,(function(t){e.$store.commit("set",["globalLoading",!1]),console.log("修改訊息成功!"),e.$router.push("/mngt/news")}),(function(e){console.log("修改訊息失敗!"),console.log(e)}))}else document.querySelector("input:invalid,select:invalid,textarea:invalid").focus()},del:function(){var e=this;if(confirm("是否確定要刪除？\n***** 請注意！刪除後無法復原！*****")){this.$store.commit("set",["globalLoading",!0]);var t=i["a"].getUrl("news","delete");l["a"].delete(t+this.newsData.id,(function(t){e.$store.commit("set",["globalLoading",!1]),console.log("刪除成功!"),e.$router.push("/mngt/news")}),(function(e){console.log("刪除失敗!"),console.log(e)}))}}}},m=d,p=(a("e382"),a("2877")),g=Object(p["a"])(m,n,s,!1,null,"bda68842",null);t["default"]=g.exports},e382:function(e,t,a){"use strict";a("a706")}}]);
//# sourceMappingURL=chunk-5691c5c6.aa9e9bb9.js.map