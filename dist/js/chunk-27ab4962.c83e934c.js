(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-27ab4962"],{"44dec":function(a,e,t){"use strict";t("a467")},"53dd":function(a,e,t){"use strict";t.r(e);var l=function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("CCard",[t("CCardHeader",{staticClass:"h5 font-weight-bold"},[t("CIcon",{staticClass:"mt-0",attrs:{name:"cil-restaurant"}}),a._v(" "+a._s(this.$route.name)+" ")],1),t("CCardBody",[t("CForm",{staticClass:"needs-validation",attrs:{id:"updateForm"}},[t("CRow",{attrs:{form:""}},[t("CCol",{staticClass:"col-form-label",attrs:{sm:"3"}},[t("label",[a._v(" 類別 "),t("span",{staticClass:"text-danger"},[a._v("*")])])]),t("CCol",{staticClass:"form-row mx-0",attrs:{sm:"9"}},[t("CSelect",{staticClass:"col-6 pl-0 pr-1",attrs:{placeholder:"請選擇類別",invalidFeedback:"必填",required:"",options:a.mealCateList},model:{value:a.mealData.category,callback:function(e){a.$set(a.mealData,"category",e)},expression:"mealData.category"}}),t("CSelect",{staticClass:"col-6 pl-1 pr-0",attrs:{placeholder:"請選擇子類別",invalidFeedback:"必填",required:"",options:a.currSubCateList},model:{value:a.mealData.sub_category,callback:function(e){a.$set(a.mealData,"sub_category",e)},expression:"mealData.sub_category"}})],1)],1),t("CInput",{attrs:{label:"名稱",placeholder:"請填寫餐點名稱",invalidFeedback:"必填",horizontal:"",required:"",maxlength:"15"},scopedSlots:a._u([{key:"label",fn:function(){return[t("label",{staticClass:"col-sm-3 col-form-label"},[a._v(" 名稱 "),t("span",{staticClass:"text-danger"},[a._v("*")])])]},proxy:!0}]),model:{value:a.mealData.name,callback:function(e){a.$set(a.mealData,"name",e)},expression:"mealData.name"}}),t("CTextarea",{attrs:{label:"描述",placeholder:"請描述餐點介紹",invalidFeedback:"必填",horizontal:"",required:"",maxlength:"220",rows:"6",description:(a.mealData.description?a.mealData.description.length:0)+" / 220",addWrapperClasses:"limit-hint"},scopedSlots:a._u([{key:"label",fn:function(){return[t("label",{staticClass:"col-sm-3 col-form-label"},[a._v(" 描述 "),t("span",{staticClass:"text-danger"},[a._v("*")])])]},proxy:!0}]),model:{value:a.mealData.description,callback:function(e){a.$set(a.mealData,"description",e)},expression:"mealData.description"}}),t("CTextarea",{attrs:{label:"內容物",placeholder:"請列舉內容物",invalidFeedback:"必填",horizontal:"",required:"",maxlength:"100",rows:"2",description:(a.mealData.ingredient?a.mealData.ingredient.length:0)+" / 100",addWrapperClasses:"limit-hint"},on:{keydown:function(e){return!e.type.indexOf("key")&&a._k(e.keyCode,"enter",13,e.key,"Enter")?null:a.reject.apply(null,arguments)}},scopedSlots:a._u([{key:"label",fn:function(){return[t("label",{staticClass:"col-sm-3 col-form-label"},[a._v(" 內容物 "),t("span",{staticClass:"text-danger"},[a._v("*")])])]},proxy:!0}]),model:{value:a.mealData.ingredient,callback:function(e){a.$set(a.mealData,"ingredient",e)},expression:"mealData.ingredient"}}),t("CInput",{attrs:{label:"備註",placeholder:"請填寫餐點備註",horizontal:"",maxlength:"250",description:(a.mealData.note?a.mealData.note.length:0)+" / 250",addWrapperClasses:"limit-hint"},model:{value:a.mealData.note,callback:function(e){a.$set(a.mealData,"note",e)},expression:"mealData.note"}}),t("CInput",{attrs:{type:"number",label:"價格",placeholder:"請填寫餐點價格",invalidFeedback:a.priceInvalidStr,horizontal:"",required:"",min:"0"},scopedSlots:a._u([{key:"label",fn:function(){return[t("label",{staticClass:"col-sm-3 col-form-label"},[a._v(" 價格 "),t("span",{staticClass:"text-danger"},[a._v("*")])])]},proxy:!0}]),model:{value:a.mealData.price,callback:function(e){a.$set(a.mealData,"price",e)},expression:"mealData.price"}}),t("ImageInput",{attrs:{label:"照片",horizontal:"",limitSize:300,limitUnit:"KB",maxPreview:"300px",oldImage:a.mealData.image,value:a.UploadImage},on:{"update:value":function(e){a.UploadImage=e}}}),t("CInput",{attrs:{type:"date",label:"限定日期",placeholder:"請選擇期間限定之餐點的下架日期",description:"此為期間限定的下架時間，若非限定餐點，則須清除日期。",horizontal:""},model:{value:a.mealData.limit_date,callback:function(e){a.$set(a.mealData,"limit_date",e)},expression:"mealData.limit_date"}}),t("CRow",{attrs:{form:""}},[t("CCol",{staticClass:"col-form-label",attrs:{sm:"3"}},[a._v(" 是否公開 "),t("span",{staticClass:"text-danger"},[a._v("*")])]),t("CCol",{staticClass:"form-row justify-content-start mx-0",attrs:{sm:"9"}},[t("CInputRadioGroup",{attrs:{custom:"",inline:"",checked:a.mealData.public,options:[{value:!0,label:"顯示"},{value:!1,label:"隱藏"}]},on:{"update:checked":function(e){return a.$set(a.mealData,"public",e)}}})],1)],1)],1)],1),t("CCardFooter",{attrs:{align:"right"}},[a.currId?t("IconButton",{staticClass:"float-left",attrs:{color:"danger",icon:"cil-trash"},on:{clickFn:function(e){return a.del()}}},[a._v("刪除此餐點")]):a._e(),t("CButton",{staticClass:"mr-3",attrs:{color:"secondary",variant:"outline",to:"/mngt/meal?cate="+this.mealData.category}},[a._v("取消")]),t("CButton",{attrs:{color:"success"},on:{click:function(e){return a.save()}}},[a._v("儲存設定")])],1)],1)},i=[],o=t("35ab"),s=t("20fc"),n=t("b76a"),r=t.n(n),c=t("7aaf"),m={name:"MealEdit",components:{draggable:r.a,ImageInput:c["a"]},data:function(){return{currId:this.$route.params.id,mealData:{id:"",category:"",sub_category:"",name:"",description:"",ingredient:"",note:"",price:"",image:"",limit_date:"",public:!0},mealCateList:[],mealSubCateList:[],UploadImage:""}},mounted:function(){this.init()},methods:{init:function(){void 0!==this.currId&&this.getMealData(),this.getMealCateList(),this.getMealSubCateList(),this.mealData.category=Number(this.$route.query.cate)},getMealData:function(){var a=this;this.$store.commit("set",["globalLoading",!0]);var e=o["a"].getUrl("meal","getOne")+this.currId;s["a"].get(e,(function(e){if(e.restData){var t=e.restData,l="";if(t.limitDate){l=t.limitDate.toString();var i=l.substr(0,4),o=l.substr(4,2),s=l.substr(6,2);l="".concat(i,"-").concat(o,"-").concat(s)}a.mealData={id:t.id,category:t.category,sub_category:t.subCategory,name:t.name,description:t.description,ingredient:t.ingredient,note:t.note,price:t.price,image:t.image,limit_date:l,public:t.public},a.$store.commit("set",["globalLoading",!1]),console.log("查詢餐點成功!")}}),(function(a){console.log("查詢餐點失敗!"),console.log(a)}))},getMealCateList:function(){var a=this;this.$store.commit("set",["globalLoading",!0]);var e=o["a"].getUrl("mealCate","getAll");s["a"].get(e,(function(e){if(e.restData){var t=e.restData;a.mealCateList=t.map((function(a){var e={value:a.id,label:a.zhName};return e})),a.$store.commit("set",["globalLoading",!1]),console.log("查詢餐點類別成功!")}}),(function(a){console.log("查詢餐點類別失敗!"),console.log(a)}))},getMealSubCateList:function(){var a=this;this.$store.commit("set",["globalLoading",!0]);var e=o["a"].getUrl("mealCate","getAllSub");s["a"].get(e,(function(e){e.restData&&(a.mealSubCateList=e.restData,a.$store.commit("set",["globalLoading",!1]),console.log("查詢餐點子類別成功!"))}),(function(a){console.log("查詢餐點子類別失敗!"),console.log(a)}))},reject:function(a){a.returnValue=!1},save:function(){var a=this,e=document.querySelector("#updateForm");if(e.classList.add("was-validated"),!0===e.checkValidity()){this.$store.commit("set",["globalLoading",!0]);var t=""!=this.UploadImage?this.UploadImage:this.mealData.image,l=this.mealData.limit_date.replace(/-/g,""),i={id:this.mealData.id,category:this.mealData.category,subCategory:this.mealData.sub_category,name:this.mealData.name,description:this.mealData.description,ingredient:this.mealData.ingredient,note:this.mealData.note,price:this.mealData.price,image:t,limitDate:l,isPublic:this.mealData.public},n=o["a"].getUrl("meal","save");s["a"].post(n,i,(function(e){a.$store.commit("set",["globalLoading",!1]),console.log("修改餐點類別成功!"),a.$router.push("/mngt/meal?cate="+a.mealData.category)}),(function(a){console.log("修改餐點類別失敗!"),console.log(a)}))}else document.querySelector("input:invalid,select:invalid,textarea:invalid").focus()},del:function(){var a=this;if(confirm("是否確定要刪除？\n***** 請注意！刪除後無法復原！*****")){this.$store.commit("set",["globalLoading",!0]);var e=o["a"].getUrl("meal","delete");s["a"].delete(e+this.mealData.id,(function(e){a.$store.commit("set",["globalLoading",!1]),console.log("刪除成功!"),a.$router.push("/mngt/meal?cate="+a.mealData.category)}),(function(a){console.log("刪除失敗!"),console.log(a)}))}}},computed:{currSubCateList:function(){var a=this,e=[],t=this.mealSubCateList.find((function(e){return e.categoryId===a.mealData.category}));return e=""==this.mealData.category?[{value:"_",label:"請先選擇大類別",disabled:!0}]:void 0===t?[{value:0,label:"無"}]:t.subCateList.map((function(a){var e={value:a.id,label:a.name};return e})),e},priceInvalidStr:function(){return""==this.mealData.price?"必填":"不可為負值"}}},d=m,u=(t("44dec"),t("2877")),g=Object(u["a"])(d,l,i,!1,null,"9ac04a74",null);e["default"]=g.exports},"5c1d":function(a,e,t){},"7aaf":function(a,e,t){"use strict";var l=function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("CInputFile",{staticClass:"form-group",attrs:{placeholder:a.UploadImageSelectedStr,custom:"",horizontal:a.horizontal,required:a.isRequired,accept:"image/*",id:a.safeId},on:{change:a.GetUploadImage},scopedSlots:a._u([a.horizontal?{key:"label",fn:function(){return[t("span",{class:a.LabelGridClass},[a._v(" "+a._s(a.label)+" "),a.isRequired?t("span",{staticClass:"text-danger"},[a._v("*")]):a._e()])]},proxy:!0}:null,{key:"description",fn:function(){return[t("div",{directives:[{name:"show",rawName:"v-show",value:a.ImagePreviewSrc,expression:"ImagePreviewSrc"}],staticClass:"mt-2"},[t("small",{staticClass:"d-block"},[a._v(a._s(a.ImagePreviewTitle))]),t("label",{staticClass:"position-relative img-thumbnail bg-white",attrs:{for:a.safeId}},[t("img",{style:"max-width:"+a.maxPreview,attrs:{src:a.ImagePreviewSrc,alt:""}}),t("CButton",{directives:[{name:"show",rawName:"v-show",value:a.UploadImage,expression:"UploadImage"}],staticClass:"align-top p-1",attrs:{color:"danger",shape:"pill"},on:{click:a.removeUploadImage}},[t("CIcon",{staticClass:"m-0",attrs:{name:"cil-x",size:"sm"}})],1)],1)])]},proxy:!0}],null,!0)})},i=[],o=function(){var a=Math.random().toString(36).substr(2);return"uid-"+a},s=o,n={name:"ImageInput",props:{value:{type:String},label:{type:String,default:""},wasValidated:Boolean,horizontal:{type:[Boolean,Object],default:!1},oldImage:{type:String,default:""},limitSize:{type:Number},limitUnit:{type:String,default:"KB"},maxPreview:{type:String,default:"100%"}},watch:{value:function(a){this.UploadImage=a},UploadImage:function(a){this.$emit("update:value",a)}},data:function(){return{UploadImage:"",UploadImageName:""}},computed:{safeId:function(){return this.id||this.$attrs.id?this.id||this.$attrs.id:s()},isRequired:function(){return""==this.oldImage},LabelGridClass:function(){return!0===this.horizontal?"col-sm-3 col-form-label":this.horizontal instanceof Object?this.horizontal.label+" col-form-label":void 0},UploadImageSelectedStr:function(){return""==this.UploadImageName?"尚未選擇檔案":this.UploadImageName},ImagePreviewTitle:function(){return this.oldImage&&!this.UploadImage?"現有影像":this.UploadImage?"上傳預覽":void 0},ImagePreviewSrc:function(){return this.oldImage&&!this.UploadImage?this.oldImage:this.UploadImage?this.UploadImage:""}},methods:{GetUploadImage:function(a,e){var t=this,l=a.item(0);if(l){var i=!this.limitSize||this.Validfile(l,"image",this.limitSize,this.limitUnit);if(i){this.UploadImageName=l.name;var o=new FileReader;o.addEventListener("load",(function(a){t.UploadImage=a.target.result})),o.readAsDataURL(l)}else this.removeUploadImage()}},Validfile:function(a,e,t,l){switch(l){case"Byte":var i=1;break;case"KB":i=1024;break;case"MB":i=1048576;break;case"GB":i=1073741824;break;default:break}var o=(a.size/i).toFixed(0),s=a.name.substring(a.name.lastIndexOf("."));switch(e){case"image":if(!s.match(/.jpg|.jpeg|.png|.svg/i))return alert("請上傳圖片檔案(.jpg|.jpeg|.png|.svg)"),!1;break;default:return console.error("type_參數設置錯誤！"),!1}return!(o>t)||(alert("檔案不能超過"+t+l),!1)},removeUploadImage:function(){this.UploadImage="",this.UploadImageName="",document.getElementById(this.safeId).value=null}}},r=n,c=(t("9a6f"),t("2877")),m=Object(c["a"])(r,l,i,!1,null,"37f136e6",null);e["a"]=m.exports},"9a6f":function(a,e,t){"use strict";t("5c1d")},a467:function(a,e,t){}}]);
//# sourceMappingURL=chunk-27ab4962.c83e934c.js.map